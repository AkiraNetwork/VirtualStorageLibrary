Under Construction. This Readme is a work in progress. Once it's completed, an English version will be provided.

---

![burner.png](images/burner.png)

<details>
  <summary>Language: English</summary>
  <ul>
    <li><a href="index.md">English</a></li>
    <li><a href="index.ja.md">Japanese</a></li>
  </ul>
</details>

# Introduction

## 背景と動機

.NETが備えているコレクションは線形コレクションです。コレクションはハッシュセット型、配列型、リスト型、辞書型など様々ありますが、本質的には線の構造となっています。  
一方、一般のファイルシステムは木形コレクションと捉える事ができます。要素はノードで管理され、階層構造になっています。  
この様な木形コレクションをサポートするライブラリは既存でいくつか存在しますが、ファイルシステムのようなモデルのライブラリを見つけることができませんでした。  
そこで私はファイルシステムを論理的に解釈し、**純粋なオブジェクトとして扱える木型のコレクションとして実装できないか**と考えアイディアをまとめました。  
階層構造のデータを柔軟に管理し、直感的にアクセスできる仕組みを作ろうと考えたのです。

## 技術的アプローチと設計思想

#### 設計の基本方針

`VirtualStorageLibrary`は、オンメモリで動作するツリー構造をベースにしたコレクションを提供し、アプリケーション開発者がデータを効率的に管理できるよう設計されています。直感的なAPIを重視し、柔軟性、拡張性を考慮した設計を採用しています。  


#### 単純性

- **ノードタイプのサポート**  
  `VirtualStorageLibrary`では、それぞれの役割に応じてノードの種類（ノードタイプ）を3つ定義しました。それは、アイテム、ディレクトリ、シンボリックリンクです。このように、ノードの役割をある程度具体化し限定することで、その役割に応じた実装が可能になります。これは、一つのノードに複数の役割を持たせる方式よりも単純で、効率的に動作させることができるという利点があります。
  
  - `VirtualItem<T>`: アイテムを表すノードです。ユーザー定義型`T`を内包しています。
  
  - `VirtualDirectory`: ディレクトリを表すノードです。
  
  - `VirtualSymbolicLink`: シンボリックリンクを表すノードです。

- **ノード間の疎結合性**  
  ノード間の疎結合性とは、ノードの依存関係を最小限に抑えることで、ノード管理の柔軟性、効率性を高める性質を意味します。一般的にツリー構造は、ノード自身が他のノードへの参照を保持し、ノードの探索をサポートします。`VirtualStorageLibrary`では、ディレクトリのみが自分の子供達のノードへの参照を保持します。つまり、ディレクトリは自分の子供達のノードにししか関心を示しません。これは、ノードツリーのコピー、移動等の操作を効率的に実行できる利点があります。

#### 柔軟性

- **ユーザー定義型のサポート**  
  `VirtualStorageLibrary`のメインとなる`VirtualStorage`クラスは、ユーザー定義型クラスを扱うジェネリック型クラスです。  
  ユーザー定義型はどのようなクラスを定義しても構いません。  
  これによって柔軟にアプリケーションデータを扱うことができます。
- **ディープクローンのサポート**  
  `VirtualStorageLibrary`は、一般のファイルシステムのように各ノードが個々の実体を持っています。  
  つまり、複数のノードが同じ実体を参照する、という事はありません。  
  ノードをコピーした場合、ノードのディープクローンが実行され、コピー元と同じ内容のノードが新たに作成されます。  
  アイテムに内包されているユーザー定義型クラスは`IVirtualDeepCloneable`インターフェースを実装する事によって、ディープクローンに対応させる事ができます。
- **パス文字の定義**  
  デフォルトで定義しているパス文字は、一般のファイルシステムで使われているセパレータ`/`、ドット`.`、ドットドット`..`、ルート文字`/`に準じて初期設定されています。  
  これらは`VirtualStorageSettings`クラスで初期設定されており、ライブラリ初期化後は`VirtualStorageState`クラスで設定を変更する事ができます。
- **ノード名禁止文字、ノード名禁止文字列の定義**  
  デフォルトで定義しているノード名禁止文字は、ドット`.`、ドットドット`..`、ノード名禁止文字列はセパレータ`/`が初期設定されています。  
  これらはディレクトリにノードを追加する際のノード名の有効性チェックで使用されます。  
  これらは`VirtualStorageSettings`クラスで初期設定されており、ライブラリ初期化後は`VirtualStorageState`クラスで設定を変更する事ができます。
- **ノードリスト表示条件の定義**  
  ノードリストはあらかじめ設定された表示条件に従って取得する事ができます。  
  表示条件は以下の要素で構成されます。  
  デフォルトは、フィルタリングなし、グルーピングあり(昇順)、ノード名プロパティによるソート(昇順)です。  
  これは`VirtualStorageSettings`クラスで初期設定されており、ライブラリ初期化後は`VirtualStorageState`クラスで設定を変更する事ができます。
  - フィルタリング  
    ノードタイプ(ディレクトリ、アイテム、シンボリックリンク)をOR条件で指定する事によってフィルタリングする事ができます。
  - グルーピング  
    ノードタイプによってグルーピングするか否かを指定できます。また、グルーピングした際には、グループの順番について昇順/降順を指定できます。
  - ソート  
    グルーピングした際にはグループ内、グルーピングしない場合は全体に対して、指定したプロパティでソートする事ができます。その際、昇順/降順を指定できます。

#### 拡張性

- **ワイルドカードのサポート**  
  パスはワイルドカードを使用する事ができます。  
  ワイルドカードを含むパスは、ワイルドカード展開用のAPIを呼ぶことにより、複数の具体的なパスに展開する事ができます。  
  ノードを操作する各APIは、展開されたパスを渡すことによってノードの操作を行うことができます。
- **ワイルドカードマッチャーの定義**  
  ワイルドカードは、`IVirtualWildcardMatcher`インターフェースを実装したワイルドカードマッチャークラスによって処理されます。  
  `VirtualStorageLibrary`では、以下の二つのクラスを事前に用意しています。  
  デフォルトは`PowerShellWildcardMatcher`です。  
  これは`VirtualStorageSettings`クラスで初期設定されており、ライブラリ初期化後は`VirtualStorageState`クラスで設定を変更する事ができます。  
  また、`IVirtualWildcardMatcher`インターフェースを実装する事より独自のワイルドカードマッチャーを使用する事も可能です。
  - `DefaultWildcardMatcher`クラス  
    正規表現をそのまま使用するワイルドカード
  - `PowerShellWildcardMatcher`クラス  
    PowerShellで採用されているワイルドカード

## ユースケースと応用シナリオ

`VirtualStorageLibrary`は、以下のような多様なユースケースでの活用が期待されます。

- 自然言語処理(NLP)
- ナレッジベースシステム
- ゲーム開発
- 階層型クラスタリング
- 教育と学習

これらの詳細なユースケースとその具体的な活用方法については、<a href="https://github.com/shimodateakira/VirtualStorageLibrary/blob/master/README.md">README</a>

をご参照ください。
